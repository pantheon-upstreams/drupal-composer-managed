{#
/**
 * @file
 * Theme implementation to display a node.
 *
 * Available variables:
 *  See embed below
 *
 * @see template_preprocess_node()
 */
#}

{% set research_classes = [
  content.field_media_primary.0 ? 'o-research--with-img',
] %}

{% set experiment_classes = [
  content.field_media_primary.0 ? 'o-experiment--with-img',
] %}

{%
  set rendered_fields = [
  'field_p_content',
  '_layout_builder',
  'field_dates',
  'field_extra_content',
  'field_key_facts',
  'field_media_primary',
  'field_research_area',
  'field_overview',
  'field_experiment_research_type',
  'field_key_experiments',
]
%}

{% if content.field_experiment_research_type.0['#markup'] == 'research_area' %}
  {% embed 'surf_main:research' with {
    research_attributes: create_attribute({'class': research_classes}),
    research_heading: label|field_value,
    research_media: content.field_media_primary.0 ? content.field_media_primary|field_value,
    research_key_experiments: content.field_key_experiments.0 ? content.field_key_experiments|field_value,
    research_overview: content.field_overview.0 ? content.field_overview|field_value,
    research_area: content.field_research_area.0 ? content.field_research_area.0['#taxonomy_term'].name.value,
    research_content: content.field_p_content,
    title_suffix: title_suffix,
    attributes,
  } only %}
  {% endembed %}

{% else %}

  {% embed 'surf_main:experiment' with {
    experiment_attributes: create_attribute({'class': experiment_classes}),
    experiment_heading: label|field_value,
    experiment_header_summary: content.field_overview.0 ? content.field_overview.0['#text'],
    experiment_media: content.field_media_primary.0 ? content.field_media_primary|field_value,
    experiment_overview: content.field_overview.0 ? content.field_overview|field_value,
    experiment_content: content.field_p_content,
    title_suffix: title_suffix,
    attributes,
  } only %}
  {% endembed %}
{% endif %}

{{ content|without(rendered_fields) }}
